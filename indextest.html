<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIIS 973 Digital Whiteboard</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @font-face {
            font-family: 'Frankfurter';
            src: url('frankfurter-medium.ttf') format('truetype');
            font-display: swap; 
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #0a0a0a; color: #f0f0f0; margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; 
            overflow-x: hidden;
            overflow-y: hidden; 
            position: relative; 
        }

        .station-logo {
            position: absolute;
            top: 20px;
            height: 60px; 
            width: auto;
            object-fit: contain;
            z-index: 10;
        }

        .logo-left { left: 20px; cursor: pointer; transition: transform 0.2s; }
        .logo-left:hover { transform: scale(1.05); }
        .logo-right { right: 20px; }

        @media (max-width: 1200px) {
            .station-logo { display: none; }
        }

        @media (max-width: 1024px) {
            body { overflow-y: auto; }
            .schedule-grid { grid-template-columns: repeat(2, 1fr) !important; }
            .bottom-row { height: auto !important; grid-template-columns: 1fr !important; }
            textarea { min-height: 120px; }
        }

        h1 { 
            text-align: center; color: #ea2776; font-family: 'Frankfurter', sans-serif;
            margin: 5px 0 15px 0; font-size: 3rem; text-transform: uppercase;
        }
        
        .schedule-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; flex-grow: 1; width: 100%;
        }

        .hour-column { 
            background: #161616; border: 1px solid #333; border-radius: 12px; 
            padding: 10px; display: flex; flex-direction: column; justify-content: space-between;
        }

        .hour-header { 
            text-align: center; font-size: 1.4rem; color: #ea2776; border-bottom: 3px solid #ea2776; 
            padding-bottom: 8px; margin-bottom: 10px; font-weight: bold;
        }

        .segment { margin-bottom: 8px; flex-grow: 1; display: flex; flex-direction: column; height: 100%; }

        .time-label { 
            font-size: 0.85rem; color: #888; margin-bottom: 2px; font-weight: bold; 
            cursor: pointer; display: inline-block; width: fit-content;
            transition: color 0.2s; user-select: none;
        }

        .editable-slot, textarea {
            transition: background 0.3s, border-color 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .editable-slot:focus, textarea:focus { 
            border-color: #ea2776 !important; 
            box-shadow: 0 0 12px rgba(234, 39, 118, 0.5) !important; 
        }

        .editable-slot {
            width: 100%; flex-grow: 1; background: #222; border: 1px solid #444; border-radius: 6px;
            color: white; padding: 5px 10px; font-size: 1.4rem; font-weight: bold;
            text-align: center; display: flex; flex-direction: column; justify-content: center;
            align-items: center; line-height: 1.1; min-height: 60px;
            word-wrap: break-word; overflow-wrap: anywhere; word-break: normal; 
            overflow: hidden; position: relative;
        }

        .editable-slot:empty:before { content: "\feff"; display: inline-block; width: 0; pointer-events: none; }

        /* Color Coding Styles */
        .state-red { background: #661111 !important; }
        .state-green { background: #114411 !important; }
        .state-blue { background: #112266 !important; }
        .state-yellow { background: #665511 !important; }
        .label-red { color: #ff5555 !important; }
        .label-green { color: #55ff55 !important; }
        .label-blue { color: #5588ff !important; }
        .label-yellow { color: #ffff55 !important; }

        .bottom-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px; height: 160px; }
        .wide-box { background: #161616; border: 1px solid #444; border-radius: 12px; padding: 12px; display: flex; flex-direction: column; }
        .wide-box label { color: #ea2776; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        textarea { width: 100%; flex-grow: 1; background: #222; color: white; border: 1px solid #444; border-radius: 6px; padding: 10px; resize: none; font-size: 1.1rem; font-family: inherit; }

        /* --- POP-UP MENU STYLES --- */
        #menu-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(8px);
            z-index: 1000; justify-content: center; align-items: center;
        }

        .menu-card {
            background: #161616; border: 2px solid #ea2776; border-radius: 15px;
            padding: 30px; width: 350px; text-align: center; box-shadow: 0 0 30px rgba(234, 39, 118, 0.3);
        }

        .menu-card h2 { color: #ea2776; font-family: 'Frankfurter', sans-serif; margin-bottom: 25px; text-transform: uppercase; }

        .menu-btn {
            display: block; width: 100%; padding: 12px; margin: 10px 0;
            background: #222; color: white; border: 1px solid #444; border-radius: 8px;
            cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: all 0.2s;
        }

        .menu-btn:hover { background: #ea2776; border-color: #ea2776; }
        .back-btn { background: #333; margin-top: 20px; border-style: dashed; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <img src="logo.png" alt="KIIS Logo" class="station-logo logo-left" onclick="toggleMenu(true)">
    <img src="logo.png" alt="KIIS Logo" class="station-logo logo-right">

    <h1>Robin, Kip & Corey</h1>
    
    <div id="grid-container" class="schedule-grid"></div>
    
    <div class="bottom-row">
        <div class="wide-box">
            <label>POST SHOW NOTES</label>
            <textarea id="post_show" oninput="handleTextArea(this)"></textarea>
        </div>
        <div class="wide-box">
            <label>FUTURE IDEAS</label>
            <textarea id="ideas" oninput="handleTextArea(this)"></textarea>
        </div>
    </div>

    <div id="menu-overlay">
        <div id="main-menu" class="menu-card">
            <h2>Whiteboard Menu</h2>
            <button class="menu-btn" onclick="clearWhiteboard()">Clear</button>
            <button class="menu-btn" onclick="saveAsPDF()">Save as PDF</button>
            <button class="menu-btn" onclick="openSubMenu('Save / Load')">Save / Load</button>
            <button class="menu-btn" onclick="openSubMenu('Options')">Options</button>
            <button class="menu-btn" onclick="openSubMenu('About')">About</button>
            <button class="menu-btn back-btn" onclick="toggleMenu(false)">Back to Whiteboard</button>
        </div>

        <div id="sub-menu" class="menu-card hidden">
            <h2 id="sub-title">Menu</h2>
            <p style="color: #888; margin-bottom: 30px;">This menu is currently a placeholder.</p>
            <button class="menu-btn back-btn" onclick="closeSubMenu()">‚Üê Back</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "PASTE_YOUR_API_KEY_HERE",
            databaseURL: "https://radioplanner-d6a88-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const colors = ['default', 'red', 'green', 'blue', 'yellow'];
        const grid = document.getElementById('grid-container');
        const startHour = 6;

        // Generate Grid
        for (let h = 0; h < 4; h++) {
            const hour = startHour + h;
            const col = document.createElement('div');
            col.className = 'hour-column';
            col.innerHTML = `<div class="hour-header">${hour}:00</div>`;
            for (let m = 0; m < 6; m++) {
                const mins = (m * 10 === 0) ? '00' : (m * 10);
                const slotId = `slot_${h}_${m}`;
                const seg = document.createElement('div');
                seg.className = 'segment';
                seg.innerHTML = `<div id="time_${slotId}" class="time-label" onclick="cycleColor('${slotId}')">${hour}:${mins}</div><div id="${slotId}" class="editable-slot" contenteditable="true" oninput="handleInput(this)" onkeydown="handleEnter(event)"></div>`;
                col.appendChild(seg);
            }
            grid.appendChild(col);
        }

        function handleEnter(e) { if (e.key === 'Enter') { e.preventDefault(); document.execCommand('insertLineBreak'); } }
        
        function cycleColor(slotId) { 
            db.ref('colors/' + slotId).once('value', (snapshot) => { 
                let currentColor = snapshot.val() || 'default'; 
                let nextIndex = (colors.indexOf(currentColor) + 1) % colors.length; 
                db.ref('colors/' + slotId).set(colors[nextIndex]); 
            }); 
        }
        
        function scaleText(el) { 
            el.style.fontSize = "1.4rem"; 
            if(!el.innerText.trim()) return; 
            let currentSize = 1.4; 
            const minSize = 0.7; 
            while (el.scrollHeight > el.offsetHeight && currentSize > minSize) { 
                currentSize -= 0.05; 
                el.style.fontSize = currentSize + "rem"; 
            } 
        }

        function handleInput(el) { scaleText(el); db.ref('planner/' + el.id).set(el.innerHTML); }
        function handleTextArea(el) { db.ref('planner/' + el.id).set(el.value); }

        // --- MENU LOGIC ---
        const overlay = document.getElementById('menu-overlay');
        const mainMenu = document.getElementById('main-menu');
        const subMenu = document.getElementById('sub-menu');
        const subTitle = document.getElementById('sub-title');

        function toggleMenu(show) {
            overlay.style.display = show ? 'flex' : 'none';
            if(show) closeSubMenu();
        }

        function openSubMenu(title) {
            mainMenu.classList.add('hidden');
            subMenu.classList.remove('hidden');
            subTitle.innerText = title;
        }

        function closeSubMenu() {
            subMenu.classList.add('hidden');
            mainMenu.classList.remove('hidden');
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === "Escape") toggleMenu(false);
        });

        function clearWhiteboard() {
            if(confirm("Clear main whiteboard and colors? (Post-show and Future Ideas will remain safe)")) {
                for (let h = 0; h < 4; h++) {
                    for (let m = 0; m < 6; m++) {
                        const id = `slot_${h}_${m}`;
                        db.ref('planner/' + id).set("");
                        db.ref('colors/' + id).set("default");
                    }
                }
                toggleMenu(false);
            }
        }

        function saveAsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 15;
            const maxLineWidth = pageWidth - margin * 2;
            
            doc.setFont("helvetica", "bold");
            doc.setFontSize(20);
            doc.setTextColor(234, 39, 118);
            doc.text("KIIS 973 - SHOW LOG", margin, 20);
            
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text("Generated: " + new Date().toLocaleString(), margin, 28);
            
            let y = 40;

            document.querySelectorAll('.hour-column').forEach(col => {
                const header = col.querySelector('.hour-header').innerText;
                if (y > 260) { doc.addPage(); y = 20; }

                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(234, 39, 118);
                doc.text(header, margin, y);
                y += 8;
                
                col.querySelectorAll('.segment').forEach(seg => {
                    const time = seg.querySelector('.time-label').innerText;
                    const content = seg.querySelector('.editable-slot').innerText.trim();
                    
                    doc.setFontSize(10);
                    doc.setFont("helvetica", "bold");
                    doc.setTextColor(0, 0, 0);
                    doc.text(`${time}:`, margin, y);
                    
                    if (content !== "") {
                        doc.setFont("helvetica", "normal");
                        const splitContent = doc.splitTextToSize(content, maxLineWidth - 20);
                        const estimatedHeight = splitContent.length * 5;
                        if (y + estimatedHeight > 280) { doc.addPage(); y = 20; doc.text(`${time}: (cont)`, margin, y); y += 5; }

                        doc.text(splitContent, margin + 15, y);
                        y += (splitContent.length * 5) + 3; 
                    } else {
                        doc.setFont("helvetica", "normal");
                        doc.setTextColor(180, 180, 180);
                        doc.text("--", margin + 15, y);
                        y += 6;
                    }
                });
                y += 10;
            });

            doc.save(`KIIS_ShowLog_${new Date().toLocaleDateString().replace(/\//g, '-')}.pdf`);
            toggleMenu(false);
        }

        // --- FIREBASE SYNC ---
        db.ref('planner').on('value', (snapshot) => { 
            const data = snapshot.val(); 
            if (data) { 
                for (let key in data) { 
                    const el = document.getElementById(key); 
                    if (el && document.activeElement !== el) { 
                        if (el.tagName === 'DIV') { 
                            el.innerHTML = data[key]; 
                            scaleText(el); 
                        } else { 
                            el.value = data[key]; 
                        } 
                    } 
                } 
            } 
        });

        db.ref('colors').on('value', (snapshot) => { 
            const colorData = snapshot.val(); 
            document.querySelectorAll('.editable-slot').forEach(el => el.classList.remove('state-red', 'state-green', 'state-blue', 'state-yellow')); 
            document.querySelectorAll('.time-label').forEach(el => el.classList.remove('label-red', 'label-green', 'label-blue', 'label-yellow')); 
            if (colorData) { 
                for (let slotId in colorData) { 
                    const color = colorData[slotId]; 
                    if (color !== 'default') { 
                        document.getElementById(slotId)?.classList.add('state-' + color); 
                        document.getElementById('time_' + slotId)?.classList.add('label-' + color); 
                    } 
                } 
            } 
        });
    </script>
</body>
</html>
