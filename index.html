<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIIS 973 Producer Planner</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @font-face {
            font-family: 'Frankfurter';
            src: url('frankfurter-medium.ttf') format('truetype');
            font-display: swap; 
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: #0a0a0a; color: #f0f0f0; margin: 0; padding: 20px;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        h1 { 
            text-align: center; color: #ea2776; font-family: 'Frankfurter', sans-serif;
            margin: 5px 0 15px 0; font-size: 3rem; text-transform: uppercase;
        }
        
        .schedule-grid { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; flex-grow: 1; width: 100%;
        }

        .hour-column { 
            background: #161616; border: 1px solid #333; border-radius: 12px; 
            padding: 10px; display: flex; flex-direction: column; justify-content: space-between;
        }

        .hour-header { 
            text-align: center; font-size: 1.4rem; color: #ea2776; border-bottom: 3px solid #ea2776; 
            padding-bottom: 8px; margin-bottom: 10px; font-weight: bold;
        }

        .segment { 
            margin-bottom: 8px; flex-grow: 1; display: flex; flex-direction: column; height: 100%;
        }

        .time-label { 
            font-size: 0.85rem; color: #888; margin-bottom: 2px; font-weight: bold; 
            cursor: pointer; display: inline-block; width: fit-content;
            transition: color 0.2s; user-select: none;
        }
        .time-label:hover { filter: brightness(1.5); }

        .editable-slot {
            width: 100%;
            flex-grow: 1;
            background: #222;
            border: 1px solid #444;
            border-radius: 6px;
            color: white;
            padding: 5px 10px;
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            outline: none;
            display: flex;
            align-items: center;
            justify-content: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden; 
            line-height: 1.1;
            transition: background 0.3s, border-color 0.3s;
        }

        /* Color States */
        .state-red { background: #661111 !important; }
        .state-green { background: #114411 !important; }
        .state-blue { background: #112266 !important; }
        .state-yellow { background: #665511 !important; }

        .label-red { color: #ff5555 !important; }
        .label-green { color: #55ff55 !important; }
        .label-blue { color: #5588ff !important; }
        .label-yellow { color: #ffff55 !important; }

        .editable-slot:focus {
            border-color: #ea2776;
            box-shadow: 0 0 8px rgba(234, 39, 118, 0.4);
        }

        .bottom-row { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; 
            margin-top: 15px; height: 160px; 
        }

        .wide-box { 
            background: #161616; border: 1px solid #444; border-radius: 12px; 
            padding: 12px; display: flex; flex-direction: column; 
        }

        .wide-box label { color: #ea2776; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }

        textarea { 
            width: 100%; flex-grow: 1; background: #222; color: white; 
            border: 1px solid #444; border-radius: 6px; padding: 10px; 
            resize: none; font-size: 1.1rem; font-family: inherit;
        }
    </style>
</head>
<body>

    <h1>KIIS 973 - Robin, Kip & Corey</h1>
    
    <div id="grid-container" class="schedule-grid"></div>

    <div class="bottom-row">
        <div class="wide-box">
            <label>POST SHOW NOTES</label>
            <textarea id="post_show" oninput="handleTextArea(this)"></textarea>
        </div>
        <div class="wide-box">
            <label>FUTURE IDEAS</label>
            <textarea id="ideas" oninput="handleTextArea(this)"></textarea>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "PASTE_YOUR_API_KEY_HERE",
            databaseURL: "https://radioplanner-d6a88-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const colors = ['default', 'red', 'green', 'blue', 'yellow'];
        const grid = document.getElementById('grid-container');
        const startHour = 6;

        for (let h = 0; h < 4; h++) {
            const hour = startHour + h;
            const col = document.createElement('div');
            col.className = 'hour-column';
            col.innerHTML = `<div class="hour-header">${hour}:00</div>`;

            for (let m = 0; m < 6; m++) {
                const mins = (m * 10 === 0) ? '00' : (m * 10);
                const slotId = `slot_${h}_${m}`;
                
                const seg = document.createElement('div');
                seg.className = 'segment';
                seg.innerHTML = `
                    <div id="time_${slotId}" class="time-label" onclick="cycleColor('${slotId}')">${hour}:${mins}</div>
                    <div id="${slotId}" class="editable-slot" contenteditable="true" oninput="handleInput(this)"></div>`;
                col.appendChild(seg);
            }
            grid.appendChild(col);
        }

        function cycleColor(slotId) {
            db.ref('colors/' + slotId).once('value', (snapshot) => {
                let currentColor = snapshot.val() || 'default';
                let nextIndex = (colors.indexOf(currentColor) + 1) % colors.length;
                db.ref('colors/' + slotId).set(colors[nextIndex]);
            });
        }

        function scaleText(el) {
            el.style.fontSize = "1.4rem";
            let currentSize = 1.4;
            const minSize = 0.7;
            while (el.scrollHeight > el.clientHeight && currentSize > minSize) {
                currentSize -= 0.05;
                el.style.fontSize = currentSize + "rem";
            }
        }

        function handleInput(el) {
            scaleText(el);
            // Using innerHTML fixes the Enter/New Line visual bug
            db.ref('planner/' + el.id).set(el.innerHTML);
        }

        function handleTextArea(el) {
            db.ref('planner/' + el.id).set(el.value);
        }

        db.ref('planner').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                for (let key in data) {
                    const el = document.getElementById(key);
                    if (el && document.activeElement !== el) {
                        if (el.tagName === 'DIV') {
                            el.innerHTML = data[key];
                            scaleText(el);
                        } else {
                            el.value = data[key];
                        }
                    }
                }
            }
        });

        db.ref('colors').on('value', (snapshot) => {
            const colorData = snapshot.val();
            document.querySelectorAll('.editable-slot').forEach(el => el.classList.remove('state-red', 'state-green', 'state-blue', 'state-yellow'));
            document.querySelectorAll('.time-label').forEach(el => el.classList.remove('label-red', 'label-green', 'label-blue', 'label-yellow'));

            if (colorData) {
                for (let slotId in colorData) {
                    const color = colorData[slotId];
                    if (color !== 'default') {
                        document.getElementById(slotId)?.classList.add('state-' + color);
                        document.getElementById('time_' + slotId)?.classList.add('label-' + color);
                    }
                }
            }
        });
    </script>
</body>
</html>
